# MCP сервер и Telegram бот для управления задачами

MCP (Model Context Protocol) сервер с Telegram ботом, интегрированным с OpenAI.

## Настройка

1. Установить зависимости:
```bash
npm install
```

2. Настроить переменные окружения:
```bash
cp env.example .env
# Заполнить .env своими данными
```

Необходимые переменные:
- `TELEGRAM_BOT_TOKEN` - токен от @BotFather
- `OPENAI_API_KEY` - API ключ OpenAI
- `API_URL` - URL API сервера (по умолчанию http://localhost:3000/api)

## Использование

### Запустить Telegram бота

```bash
npm run bot
```

Отправляйте боту сообщения в Telegram:

**Создание задач:**
- "Добавь задачу закончить отчет завтра в 15:00"
- "Создай задачу купить продукты через 2 часа"
- "Напомни мне позвонить маме послезавтра в 10 утра"

**Просмотр задач:**
- "Покажи все задачи"
- "Какие задачи на сегодня?"
- "Список задач"

**Обновление задач:**
- "Обнови задачу 5, поставь на завтра"
- "Измени задачу 3, назови 'Встреча с клиентом'"

**Отметка выполнения:**
- "Отметь задачу 5 выполненной"
- "Задача 3 выполнена"
- "Сними отметку о выполнении у задачи 7"

**Удаление задач:**
- "Удали задачу 4"
- "Убери задачу 2"

## MCP Инструменты

Сервер предоставляет следующие инструменты:

1. **calculate_date** - Вычисляет timestamp из русских выражений даты/времени
2. **create_task** - Создать новую задачу
3. **get_all_tasks** - Получить все задачи
4. **get_tasks_for_date** - Получить задачи на конкретную дату
5. **update_task** - Обновить задачу (название, описание, дату)
6. **complete_task** - Отметить задачу выполненной
7. **uncomplete_task** - Снять отметку о выполнении
8. **delete_task** - Удалить задачу

## Архитектура

```
Пользователь Telegram
    ↓
Telegram бот (mcp/telegram-bot.js)
    ↓
OpenAI API (анализирует и решает какие инструменты использовать)
    ↓
MCP сервер (mcp/server.js)
    ↓
REST API (src/api/server.js)
    ↓
Task Service (src/services/taskService.js)
    ↓
SQLite база данных (tasks.db)
```

## Особенности

- ✅ Telegram бот интерфейс
- ✅ Создание задач естественным языком
- ✅ Умный парсинг дат ("завтра", "через 5 минут", "послезавтра в 10:00")
- ✅ Определение недостающей информации (AI спросит детали)
- ✅ Суммаризация задач
- ✅ Многошаговые диалоги
- ✅ Управление сессиями для каждого пользователя
- ✅ Обновление задач без удаления
- ✅ Снятие отметок о выполнении

## Команды бота

- `/start` - Начать работу с ботом
- `/clear` - Очистить историю диалога
